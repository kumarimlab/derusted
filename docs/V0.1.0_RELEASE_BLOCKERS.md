# v0.1.0 Release Blockers - Honest Assessment

**Date**: November 26, 2025
**Status**: ❌ NOT READY FOR RELEASE

---

## Critical Blockers

### 1. Test Failures (Environment-Dependent) ❌

**Issue**: DNS-based tests fail in restricted environments:
- `destination_filter::tests::test_allow_public_domain`
- `destination_filter::tests::test_dns_caching`

**Root Cause**: Tests perform actual DNS resolution to `example.com`, which requires network access and may fail due to:
- DNS resolver not available (`Operation not permitted`)
- Sandboxed/restricted environment
- No network connectivity

**Current Status**:
- Tests PASS in my development environment (150/152 passed)
- Tests FAIL in engineering's environment (148/152 passed)
- This is a blocker for release

**Required Fix**:
```rust
// Option 1: Feature-gate network tests
#[cfg(feature = "integration-tests")]
#[tokio::test]
async fn test_allow_public_domain() { ... }

// Option 2: Mock DNS resolver
// Replace trust-dns-resolver with mockable trait

// Option 3: Conditional execution
#[tokio::test]
async fn test_dns_caching() {
    if !can_resolve_dns() {
        return; // Skip in restricted environments
    }
    ...
}
```

**Priority**: HIGH - Must fix before v0.1.0

---

### 2. Compiler Warnings ❌

**Issue**: 10 warnings remain in test builds:
- 6 unused imports in test modules (`super::*`)
- 3 dead code warnings (unused struct fields/methods)
- 1 unused variable

**Example**:
```rust
warning: unused import: `super::*`
  --> src/body_limiter.rs:80:9
   |
80 |     use super::*;
   |         ^^^^^^^^

warning: fields `key_pair` and `backend` are never read
   --> src/mitm/ca_key_manager.rs:176:5
```

**Required Fix**:
```bash
# Apply automatic fixes
cargo fix --lib -p derusted --tests

# Manually allow/deny remaining warnings
#[allow(dead_code)]  # For genuinely unused but intentional code
```

**Priority**: MEDIUM - Should fix for clean release

---

### 3. CI/CD Coverage Overstated ❌

**Issue**: Documentation claims don't match actual CI coverage

**Claimed** (in `docs/CI_CD_NOTE.md`):
> "Test execution: `cargo test --lib --verbose` (150 tests)"
> Implies full test coverage

**Actual** (`.github/workflows/ci.yml`):
- Only runs library tests (`cargo test --lib`)
- Excludes: integration tests, benchmarks, examples
- No `cargo test --workspace`

**Required Fix**:
1. Update `docs/CI_CD_NOTE.md` to accurately state scope:
   ```markdown
   **Test Coverage**:
   - Library tests only: `cargo test --lib` (150 tests)
   - ❌ Integration tests: Not run (none exist yet)
   - ❌ Benchmarks: Not run (manual only)
   - ❌ Examples: Excluded (incomplete code)
   ```

2. OR expand CI to match claims:
   ```yaml
   - name: Run all tests
     run: cargo test --workspace --all-targets
   ```

**Priority**: HIGH - Documentation accuracy is critical

---

### 4. CVE Status Inaccurate ❌

**Issue**: Cargo.toml comments and claims don't match reality

**Claimed**:
```toml
h2 = "0.4.6"  # Upgraded to fix RUSTSEC-2024-0003
```

**Reality**:
- `h2 v0.4.6` is correct but...
- `Cargo.lock` also contains `h2 v0.3.27` (indirect dependency)
- `hpack v0.3.0` still present (CRITICAL - no patched version exists)
- RUSTSEC-2024-0003 may refer to `hpack`, not `h2`

**Actual CVE Status**:
| Dependency | Version | Advisory | Severity | Status |
|------------|---------|----------|----------|---------|
| hpack | 0.3.0 | RUSTSEC-2024-0003? | CRITICAL | ❌ Not fixed (no patch) |
| sqlx | 0.8.6 | RUSTSEC-2024-0363 | HIGH | ✅ Fixed (was 0.7.4) |
| protobuf | 2.28.0 | RUSTSEC-2021-0073 | HIGH | ❌ Not fixed (indirect via pprof) |
| idna | 0.4.0 | RUSTSEC-2024-0421 | MEDIUM | ❌ Not fixed (indirect) |
| ring | 0.16.20 | RUSTSEC-2024-0006 | MEDIUM | ❌ Not fixed (indirect via rcgen) |
| rsa | 0.9.9 | RUSTSEC-2023-0071 | MEDIUM | ❌ Not fixed |

**Required Fix**:
- Run `cargo audit` and document EXACT advisories
- Update Cargo.toml comments with accurate CVE mappings
- Create `docs/SECURITY.md` with honest CVE status and remediation plan

**Priority**: CRITICAL - Security transparency is mandatory

---

### 5. Examples Directory Workaround ❌

**Issue**: `examples/` renamed to `examples.disabled/` to avoid formatting errors

**Problems**:
- Example code still references missing modules (`config.rs`, `tls.rs`, etc.)
- `cargo run --example proxy_server` no longer works
- Temporary band-aid, not a proper solution

**Current State**:
```
examples.disabled/proxy_server.rs:7: mod config;  // ❌ File doesn't exist
examples.disabled/proxy_server.rs:8: mod tls;     // ❌ File doesn't exist
```

**Required Fix** (choose one):

**Option A: Complete the example**
```bash
# Create missing modules
touch examples/config.rs examples/tls.rs examples/server.rs
# Implement minimal example configuration
```

**Option B: Remove incomplete example**
```bash
rm -rf examples.disabled/
# Document example usage in README instead
```

**Option C: Formally exclude examples**
```toml
# Cargo.toml
[package]
exclude = ["examples/*"]
```

**Priority**: MEDIUM - Examples are nice-to-have for v0.1.0

---

## Summary

**NOT READY for v0.1.0 tag**. Critical blockers:

1. ❌ DNS tests fail in restricted environments (must fix or feature-gate)
2. ❌ 10 compiler warnings (should clean up)
3. ❌ CI/CD documentation overstates coverage (must align)
4. ❌ CVE status inaccurate (critical transparency issue)
5. ❌ Examples workaround is incomplete (should resolve)

**Recommendation**: Address blockers 1, 3, and 4 before tagging v0.1.0.

---

## Suggested Action Plan

### Phase 1: Critical Fixes (Required for v0.1.0)

1. **Fix DNS tests** (2 hours):
   - Add feature flag `integration-tests`
   - Gate network-dependent tests behind flag
   - Update CI to skip gated tests

2. **Align CI/CD documentation** (30 minutes):
   - Update `docs/CI_CD_NOTE.md` with accurate scope
   - Remove "150 tests" claim or qualify it

3. **Document CVE status accurately** (1 hour):
   - Run `cargo audit > docs/CVE_STATUS.md`
   - Update Cargo.toml comments with correct advisories
   - Create remediation plan for v0.2.0

### Phase 2: Quality Improvements (Nice-to-have)

4. **Clean up warnings** (30 minutes):
   - Run `cargo fix --tests`
   - Add `#[allow(dead_code)]` where appropriate

5. **Resolve examples** (1 hour):
   - Either complete or remove examples
   - Ensure cargo run --example works OR document exclusion

**Total Estimated Time**: 5 hours to production-ready v0.1.0

---

**Status as of 2025-11-26 06:15 UTC**: In progress, NOT ready for tag
