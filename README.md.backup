# Derusted

**Production-ready Rust forward proxy with MITM capabilities**

[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)
[![Rust](https://img.shields.io/badge/rust-1.70%2B-orange.svg)](https://www.rust-lang.org/)

Derusted is a high-performance forward proxy library built in Rust, designed for safety, speed, and reliability. It provides MITM (Man-In-The-Middle) capabilities for HTTPS content inspection while maintaining excellent performance.

---

## ğŸš€ Features

### Core Capabilities
- âœ… **HTTP/1.1 & HTTP/2** - Full protocol support with ALPN negotiation
- âœ… **MITM/SSL Interception** - Dynamic certificate generation for HTTPS inspection
- âœ… **JWT Authentication** - HS256/384/512 token-based auth
- âœ… **Rate Limiting** - Token bucket algorithm with configurable limits
- âœ… **Smart Bypass** - Intelligent bypass for certificate-pinned domains
- âœ… **SSRF Protection** - DNS-based SSRF prevention
- âœ… **Prometheus Metrics** - Production-ready observability

### Performance
- **60 req/s** throughput (tested)
- **<1ms** MITM certificate generation (cached)
- **1.72MB** memory footprint (base)
- **97.9%** RFC 9113 compliance (HTTP/2)

---

## ğŸ“¦ Installation

Add to your `Cargo.toml`:

```toml
[dependencies]
derusted = "0.1"
```

Or use the latest git version:

```toml
[dependencies]
derusted = { git = "https://github.com/your-org/derusted" }
```

---

## ğŸ¯ Quick Start

### Basic MITM Proxy

```rust
use derusted::{CertificateAuthority, MitmConfig};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // Create Certificate Authority
    let config = MitmConfig {
        ca_cert_path: "ca.crt".to_string(),
        ca_key_path: "ca.key".to_string(),
        cert_cache_size: 10_000,
        cert_validity_days: 365,
        enable_hot_reload: true,
    };

    let ca = CertificateAuthority::new(config.into()).await?;

    // Generate certificate for domain
    let cert = ca.get_or_generate("example.com").await?;
    println!("Certificate: {}", cert.pem());

    Ok(())
}
```

### With JWT Authentication

```rust
use derusted::{JwtValidator, AuthConfig};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let config = AuthConfig {
        secret: "your-secret-key".to_string(),
        algorithm: "HS256".to_string(),
        issuer: Some("your-issuer".to_string()),
        audience: Some("your-audience".to_string()),
    };

    let validator = JwtValidator::new(config)?;

    // Validate token
    let claims = validator.validate("eyJ...")?;
    println!("User: {}", claims.sub);

    Ok(())
}
```

### With Rate Limiting

```rust
use derusted::{RateLimiter, RateLimiterConfig};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let config = RateLimiterConfig {
        requests_per_second: 10,
        burst_size: 20,
    };

    let limiter = RateLimiter::new(config);

    // Check rate limit
    if limiter.check_rate_limit("user-id").await? {
        // Process request
    } else {
        // Return 429 Too Many Requests
    }

    Ok(())
}
```

---

## ğŸ“š Architecture

Derusted is designed as a **library**, not a standalone proxy. You embed it in your application:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Your Application (Binary)      â”‚
â”‚  (Gateway, Master, or Custom)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ uses
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Derusted (Library)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”œâ”€ mitm/         # MITM core        â”‚
â”‚ â”œâ”€ auth/         # Authentication   â”‚
â”‚ â”œâ”€ rate_limiter/ # Rate limiting    â”‚
â”‚ â”œâ”€ server/       # Proxy server     â”‚
â”‚ â””â”€ ...                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Modules

| Module | Description | Status |
|--------|-------------|--------|
| `mitm` | MITM/SSL interception core | âœ… Phase 1 (Week 1-4) |
| `auth` | JWT authentication | âœ… Complete |
| `rate_limiter` | Token bucket rate limiting | âœ… Complete |
| `destination_filter` | URL/domain filtering | âœ… Complete |
| `ip_tracker` | IP tracking & SSRF protection | âœ… Complete |
| `http_client` | Upstream HTTP client | âœ… Complete |
| `server` | Core proxy server logic | âœ… Complete |

---

## ğŸ§ª Testing

```bash
# Run all tests
cargo test

# Run specific module tests
cargo test --lib mitm

# Run with output
cargo test -- --nocapture

# Run with debug logs
RUST_LOG=debug cargo test -- --nocapture
```

---

## ğŸ“– Documentation

Generate and open documentation:

```bash
cargo doc --open
```

---

## ğŸ› ï¸ Development

### Prerequisites
- Rust 1.70+
- tokio runtime

### Build
```bash
# Debug build
cargo build

# Release build (optimized)
cargo build --release

# Check without building
cargo check
```

### Code Quality
```bash
# Format code
cargo fmt

# Lint code
cargo clippy

# Security audit
cargo audit
```

---

## ğŸŒŸ Use Cases

Derusted is used as the foundation for:
- **Enterprise proxies** with content inspection
- **Security gateways** with DLP capabilities
- **API gateways** with authentication
- **Development proxies** for debugging

---

## ğŸ¤ Contributing

Contributions are welcome! Please see [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.

### Development Workflow
1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

---

## ğŸ“ License

Licensed under the Apache License, Version 2.0. See [LICENSE](LICENSE) for details.

---

## ğŸ”— Links

- **Documentation**: https://docs.rs/derusted
- **Repository**: https://github.com/your-org/derusted
- **Issue Tracker**: https://github.com/your-org/derusted/issues

---

## ğŸ† Acknowledgments

Derusted builds on the excellent Rust ecosystem:
- `tokio` - Async runtime
- `hyper` - HTTP implementation
- `rustls` - TLS implementation
- `rcgen` - Certificate generation

---

**Built with â¤ï¸ in Rust**
