# Pinaka Rust Proxy - Environment Configuration Template
# Copy this file to .env and fill in your values

# ============================================
# Server Configuration
# ============================================
PROXY_HOST=0.0.0.0
PROXY_PORT=443

# ============================================
# TLS/SSL Configuration
# ============================================
# Path to TLS certificate and private key
# For Let's Encrypt: /etc/letsencrypt/live/your-domain.com/fullchain.pem
# For self-signed: /path/to/your/cert.pem
TLS_CERT_PATH=/etc/letsencrypt/live/your-domain.com/fullchain.pem
TLS_KEY_PATH=/etc/letsencrypt/live/your-domain.com/privkey.pem

# ============================================
# JWT Authentication
# ============================================
# Secret key for JWT validation (MUST be 32+ characters)
JWT_SECRET=your_secret_key_at_least_32_characters_long

# JWT algorithm (HS256, HS384, or HS512)
JWT_ALGORITHM=HS256

# Optional: JWT issuer and audience validation (recommended for production)
# JWT_ISSUER=your-issuer
# JWT_AUDIENCE=your-audience

# ============================================
# Rate Limiting
# ============================================
# Requests per minute per token
RATE_LIMIT_REQUESTS_PER_MINUTE=10000

# Burst capacity (allows temporary bursts above the rate limit)
RATE_LIMIT_BURST_SIZE=500

# Token bucket TTL in seconds (cleanup old buckets)
RATE_LIMIT_BUCKET_TTL_SECONDS=300

# Maximum number of token buckets to track
RATE_LIMIT_MAX_BUCKETS=10000

# ============================================
# HTTP Proxy Configuration
# ============================================
# Enable HTTP forwarding (GET, POST, etc.) in addition to CONNECT
HTTP_PROXY_ENABLED=true

# Maximum request body size (bytes) - 100MB default
MAX_REQUEST_BODY_SIZE=104857600

# Maximum response body size (bytes) - 100MB default
MAX_RESPONSE_BODY_SIZE=104857600

# Connection timeout (seconds)
CONNECT_TIMEOUT_SECONDS=10

# Read timeout (seconds)
READ_TIMEOUT_SECONDS=30

# Write timeout (seconds)
WRITE_TIMEOUT_SECONDS=30

# ============================================
# Backend API Integration (Optional)
# ============================================
# Backend URL for request logging
BACKEND_URL=https://your-backend.com

# Probe node identification
PROBE_NODE_NAME=probe-node-1
PROBE_NODE_REGION=us-east

# Log batch configuration
LOG_BATCH_SIZE=100
LOG_BATCH_INTERVAL_SECS=5

# ============================================
# DNS & SSRF Protection
# ============================================
# DNS cache size
DNS_CACHE_SIZE=5000

# DNS cache TTL (seconds)
DNS_CACHE_TTL_SECONDS=60

# DNS resolver timeout (seconds)
DNS_RESOLVER_TIMEOUT_SECONDS=5

# ============================================
# IP Tracking (Multi-IP Detection)
# ============================================
# Maximum unique IPs allowed per token
MAX_IPS_PER_TOKEN=5

# IP tracker cache size
IP_TRACKER_CACHE_SIZE=10000

# IP tracker TTL (seconds)
IP_TRACKER_TTL_SECONDS=3600

# ============================================
# Mixed Content Policy (v0.2.0+)
# ============================================
# Policy for handling HTTP requests with HTTPS Referer/Origin
# Options:
#   - allow: Pass through all HTTP requests (default, no warnings suppression)
#   - upgrade: Try to upgrade HTTPâ†’HTTPS, with configurable failure handling
#   - block: Block all HTTP requests with HTTPS Referer (strict mode)
MIXED_CONTENT_POLICY=allow

# Action to take when HTTPS upgrade fails (only used when policy=upgrade)
# Options:
#   - warn: Log warning and allow HTTP request (recommended, lenient)
#   - fallback: Silently allow HTTP request on upgrade failure
#   - block: Return 502 Bad Gateway on upgrade failure (may break sites)
UPGRADE_FAILURE_ACTION=warn

# Timeout for HTTPS availability probe in milliseconds
UPGRADE_PROBE_TIMEOUT=1000

# ============================================
# Logging
# ============================================
# Rust log level (error, warn, info, debug, trace)
# Use info for production, debug for troubleshooting
RUST_LOG=info
